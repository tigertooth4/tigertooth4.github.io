<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>自己建了一个SS | 思｜制 - A guy&#39;s thinking and making</title>
<meta name="keywords" content="SS, VPN" />
<meta name="description" content="趁着国庆假期，终于有时间把SS搞好了。自从上次qiang变高以后，就萌生了自己建站的念头。没有选择 Linode 的主机，因为树大招风嘛。选择了同样来自日">
<meta name="author" content="tt4">
<link rel="canonical" href="http://tigertooth4.github.io/post/life/%E8%87%AA%E5%B7%B1%E5%BB%BA%E4%BA%86%E4%B8%AAss/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.e5fda93abf3cc727f654cc8a13d9ef3949ae4d6d11c35ebf8377e9022955c40b.css" integrity="sha256-5f2pOr88xyf2VMyKE9nvOUmuTW0Rw16/g3fpAilVxAs=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://tigertooth4.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://tigertooth4.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://tigertooth4.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://tigertooth4.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="http://tigertooth4.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.92.2" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="自己建了一个SS" />
<meta property="og:description" content="趁着国庆假期，终于有时间把SS搞好了。自从上次qiang变高以后，就萌生了自己建站的念头。没有选择 Linode 的主机，因为树大招风嘛。选择了同样来自日" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://tigertooth4.github.io/post/life/%E8%87%AA%E5%B7%B1%E5%BB%BA%E4%BA%86%E4%B8%AAss/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2015-10-03T12:15:00&#43;00:00" />
<meta property="article:modified_time" content="2015-10-03T12:15:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="自己建了一个SS"/>
<meta name="twitter:description" content="趁着国庆假期，终于有时间把SS搞好了。自从上次qiang变高以后，就萌生了自己建站的念头。没有选择 Linode 的主机，因为树大招风嘛。选择了同样来自日"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "http://tigertooth4.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "自己建了一个SS",
      "item": "http://tigertooth4.github.io/post/life/%E8%87%AA%E5%B7%B1%E5%BB%BA%E4%BA%86%E4%B8%AAss/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "自己建了一个SS",
  "name": "自己建了一个SS",
  "description": "趁着国庆假期，终于有时间把SS搞好了。自从上次qiang变高以后，就萌生了自己建站的念头。没有选择 Linode 的主机，因为树大招风嘛。选择了同样来自日",
  "keywords": [
    "SS", "VPN"
  ],
  "articleBody": "趁着国庆假期，终于有时间把SS搞好了。自从上次qiang变高以后，就萌生了自己建站的念头。没有选择 Linode 的主机，因为树大招风嘛。选择了同样来自日本的 Conoha.jp 。选择了 50G SSD 和 1G 内存的日本主机，搭配 CentOS 7 操作系统。 整个建立虚拟主机的过程都比较顺利，付出了一个月 900 日元的代价。具体过程就不再赘述了。 下面主要说说建立 SS 的过程。我用的是 SS 的 Python 版。\n安装SS 分两步，先安装 python 和 包管理工具 pip，再直接安装 ss，至于 ss 是什么，你懂的 ：）今后遇到 ss 的地方，请用你知道的单词代替（如果不明确指出，全用小写）。\n首先连接到 conoha 的 VPS 服务器，使用 usr@ip 的方式\nssh root@VPS_IP yum install python-setuptools \u0026\u0026 easy_install pip pip install ss 安装到这一步的时候出现了 InsecurePlatformWarning 的警告，不知所措，google 了一下以后开始有病乱投医：\npip install pyopenssl ndg-httpsclient pyasn1 pip install libffi pip install requests==2.5.3 pip install ss (这一步说 requirement already satisfied！) 建立 ss 配置文件 mkdir -p /etc/ss vim /etc/ss/config.json 在 config.json 中输入以下内容：\n{ \"server\":\"Conoha 的 server ip\", \"server_port\":（端口，可以自己定义）, \"local_address\": \"127.0.0.1\", \"local_port\":1080, \"password\":\"（你的连接密码）\", \"timeout\":300, \"method\":\"aes-256-cfb\", \"fast_open\": false, \"workers\": 1 } 新建服务文件 vim /etc/systemd/system/ss-server.service 输入以下内容\n[Unit] Description=Ss Server After=network.target [Service] Type=forking PIDFile=/run/ss/server.pid PermissionsStartOnly=true ExecStartPre=/bin/mkdir -p /run/ss ExecStartPre=/bin/chown root:root /run/ss ExecStart=/usr/bin/ssserver (这里不替换) --pid-file /var/run/ss/server.pid -c /etc/ss/config.json -d start Restart=on-abort User=root Group=root UMask=0027 [Install] WantedBy=multi-user.target 运行 ss 服务，设为开机自启动 systemctl start ss-server.service systemctl enable ss-server.service 防火墙开启你指定的端口 firewall-cmd --permanent --add-port=指定端口/tcp firewall-cmd --reload 如果要配置多用户，参考了 QQ 群中的代码 类似这样：\n{ \"server\":\"0.0.0.0\", \"local_address\":\"127.0.0.1\", \"local_port\":1080, \"port_password\":{ \"8989\":\"password0\", \"9001\":\"password1\", \"9002\":\"password2\", \"9003\":\"password3\", \"9004\":\"password4\" }, \"timeout\":300, \"method\":\"chacha20\", \"fast_open\": false } 常见维护操作 升级 ss\npip install -U shadowsocks 卸载 ss\npip uninstall shadowsocks 停止 ss 服务\nsystemctl stop shadowsocks-server.service 让 Mail.app 复活 我用了 Proximac，但是，鉴于苹果在升级到 10.11 El Capitan 之后，不允许哪怕 root 用户修改 /usr，所以 homebrew 没办法用了。必须要先修改权限。官方的解释请看这里。\nsudo chown $(whoami):admin /usr/local \u0026\u0026 sudo chown -R $(whoami):admin /usr/local 注意，要使 /usr/local/sbin 也在你的路径变量里面。因为我是用的 fish, 其环境变量是在 .config/fish/config.fish 里面设置。于是，添加这个路径可以这样写：\nset PATH /usr/local/sbin $PATH 可以用 echo “$PATH” 来检查路径好了没。然后，我们来试试 homebrew 好了没。 [未完，待续…] 【更新】下面就是安装 proximac 了！我已经 fork 了这个项目。根据作者的指导，第一步要安装 libuv 这个库。\nbrew install libuv 然后下载安装文件\ncurl -fsSL https://raw.githubusercontent.com/proximac-org/proximac-install/master/install.py |python 其实这一步就是从网上把写好的 zip 包下载下来，解压，改权限，放到 /usr/local/proximac 目录下面。最重要的就是 kext 内核扩展文件。运行 /usr/local/bin/proximac 的时候主要调用的是这个。但是，从 Mac OSX El Capitan 以后，系统引进了所谓 rootless 的特性，就是不再允许哪怕是 root 用户修改特定的系统文件（苹果这么做的原因可以参考WWDC15的视频）\n因此，如果想继续使用 proximac 只有一种办法，那就是禁用掉这个新特性，public beta 版本中的修改内核参数的方法在正式版中会失效，唯一的办法就是在启动的时候用 csrutil 这个工具:\n 启动时按住 command+R 直到进入保护模式 在保护模式中打开终端，输入如下指令 csrutil disable (注意：csrutil enable –without debug 这种写法将来恐怕也会失效，所以最好还是用 disable 这个选项） 正常重启动 用了这招，proximac 就可以正常启动了！  ![](~/屏幕快照 2015-10-05 上午12.25.28.png)\n参考  IFshow（主要参考） IFshow 优化 史上最详细教程 破.前路的 CentOS7 libev 配置 aa65535 的 gist vfasky 的在 CentOS6 上部署（要用 iptables） teddysun 的一键安装脚本 libev 版 teddysun 的 python 版(含加密方式讨论) CentOS 7 中使用的防火墙 firewalld 的使用说明 Stackoverflow 中关于 InsecurePlatformWarning 关于安装中的 InsecurePlatformWarning WWDC15 v2ex 上面的讨论 Quora 上面的讨论 Macworld 上面关于如何修改的讨论 Apple 官方论坛上的讨论  ",
  "wordCount" : "1332",
  "inLanguage": "zh-cn",
  "datePublished": "2015-10-03T12:15:00Z",
  "dateModified": "2015-10-03T12:15:00Z",
  "author":{
    "@type": "Person",
    "name": "tt4"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://tigertooth4.github.io/post/life/%E8%87%AA%E5%B7%B1%E5%BB%BA%E4%BA%86%E4%B8%AAss/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "思｜制 - A guy's thinking and making",
    "logo": {
      "@type": "ImageObject",
      "url": "http://tigertooth4.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://tigertooth4.github.io" accesskey="h" title="思｜制 - A guy&#39;s thinking and making (Alt + H)">思｜制 - A guy&#39;s thinking and making</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="http://tigertooth4.github.io/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://tigertooth4.github.io/post/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="http://tigertooth4.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://tigertooth4.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
    <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      自己建了一个SS
    </h1>
    <div class="post-meta"><span title='2015-10-03 12:15:00 +0000 UTC'>October 3, 2015</span>&nbsp;·&nbsp;tt4

</div>
  </header> 
  <div class="post-content"><p>趁着国庆假期，终于有时间把SS搞好了。自从上次qiang变高以后，就萌生了自己建站的念头。没有选择 Linode 的主机，因为树大招风嘛。选择了同样来自日本的 Conoha.jp 。选择了 50G SSD 和 1G 内存的日本主机，搭配 CentOS 7 操作系统。
整个建立虚拟主机的过程都比较顺利，付出了一个月 900 日元的代价。具体过程就不再赘述了。
下面主要说说建立 SS 的过程。我用的是 SS 的 Python 版。</p>
<h1 id="安装ss">安装SS<a hidden class="anchor" aria-hidden="true" href="#安装ss">#</a></h1>
<p>分两步，先安装 python 和 包管理工具 pip，再直接安装 ss，至于 ss 是什么，你懂的 ：）今后遇到 ss 的地方，请用你知道的单词代替（如果不明确指出，全用小写）。</p>
<p>首先连接到 conoha 的 VPS 服务器，使用 usr@ip 的方式</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ssh root@VPS_IP
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">yum install python-setuptools <span style="color:#f92672">&amp;&amp;</span> easy_install pip
pip install ss
</code></pre></div><p>安装到这一步的时候出现了 InsecurePlatformWarning 的警告，不知所措，google 了一下以后开始有病乱投医：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pip install pyopenssl ndg-httpsclient pyasn1
pip install libffi
pip install requests<span style="color:#f92672">==</span>2.5.3
pip install ss <span style="color:#f92672">(</span>这一步说 requirement already satisfied！<span style="color:#f92672">)</span>
</code></pre></div><h1 id="建立-ss-配置文件">建立 ss 配置文件<a hidden class="anchor" aria-hidden="true" href="#建立-ss-配置文件">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir -p /etc/ss
vim /etc/ss/config.json
</code></pre></div><p>在 config.json 中输入以下内容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">{</span>
 <span style="color:#e6db74">&#34;server&#34;</span>:<span style="color:#e6db74">&#34;Conoha 的 server ip&#34;</span>,
 <span style="color:#e6db74">&#34;server_port&#34;</span>:（端口，可以自己定义）,
 <span style="color:#e6db74">&#34;local_address&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
 <span style="color:#e6db74">&#34;local_port&#34;</span>:1080,
 <span style="color:#e6db74">&#34;password&#34;</span>:<span style="color:#e6db74">&#34;（你的连接密码）&#34;</span>,
 <span style="color:#e6db74">&#34;timeout&#34;</span>:300,
 <span style="color:#e6db74">&#34;method&#34;</span>:<span style="color:#e6db74">&#34;aes-256-cfb&#34;</span>,
 <span style="color:#e6db74">&#34;fast_open&#34;</span>: false,
 <span style="color:#e6db74">&#34;workers&#34;</span>: <span style="color:#ae81ff">1</span>
<span style="color:#f92672">}</span>
</code></pre></div><h1 id="新建服务文件">新建服务文件<a hidden class="anchor" aria-hidden="true" href="#新建服务文件">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">vim /etc/systemd/system/ss-server.service
</code></pre></div><p>输入以下内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
Description<span style="color:#f92672">=</span>Ss Server
After<span style="color:#f92672">=</span>network.target

<span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
Type<span style="color:#f92672">=</span>forking
PIDFile<span style="color:#f92672">=</span>/run/ss/server.pid
PermissionsStartOnly<span style="color:#f92672">=</span>true
ExecStartPre<span style="color:#f92672">=</span>/bin/mkdir -p /run/ss
ExecStartPre<span style="color:#f92672">=</span>/bin/chown root:root /run/ss
ExecStart<span style="color:#f92672">=</span>/usr/bin/ssserver <span style="color:#f92672">(</span>这里不替换<span style="color:#f92672">)</span> --pid-file /var/run/ss/server.pid -c /etc/ss/config.json -d start
Restart<span style="color:#f92672">=</span>on-abort
User<span style="color:#f92672">=</span>root
Group<span style="color:#f92672">=</span>root
UMask<span style="color:#f92672">=</span><span style="color:#ae81ff">0027</span>

<span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
WantedBy<span style="color:#f92672">=</span>multi-user.target
</code></pre></div><h1 id="运行-ss-服务设为开机自启动">运行 ss 服务，设为开机自启动<a hidden class="anchor" aria-hidden="true" href="#运行-ss-服务设为开机自启动">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">systemctl start ss-server.service
systemctl enable ss-server.service
</code></pre></div><h1 id="防火墙开启你指定的端口">防火墙开启你指定的端口<a hidden class="anchor" aria-hidden="true" href="#防火墙开启你指定的端口">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">firewall-cmd --permanent --add-port<span style="color:#f92672">=</span>指定端口/tcp
firewall-cmd --reload
</code></pre></div><h1 id="如果要配置多用户参考了-qq-群中的代码">如果要配置多用户，参考了 QQ 群中的代码<a hidden class="anchor" aria-hidden="true" href="#如果要配置多用户参考了-qq-群中的代码">#</a></h1>
<p>类似这样：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;server&#34;</span>:<span style="color:#e6db74">&#34;0.0.0.0&#34;</span>,
    <span style="color:#e6db74">&#34;local_address&#34;</span>:<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
    <span style="color:#e6db74">&#34;local_port&#34;</span>:1080,
    <span style="color:#e6db74">&#34;port_password&#34;</span>:<span style="color:#f92672">{</span>
         <span style="color:#e6db74">&#34;8989&#34;</span>:<span style="color:#e6db74">&#34;password0&#34;</span>,
         <span style="color:#e6db74">&#34;9001&#34;</span>:<span style="color:#e6db74">&#34;password1&#34;</span>,
         <span style="color:#e6db74">&#34;9002&#34;</span>:<span style="color:#e6db74">&#34;password2&#34;</span>,
         <span style="color:#e6db74">&#34;9003&#34;</span>:<span style="color:#e6db74">&#34;password3&#34;</span>,
         <span style="color:#e6db74">&#34;9004&#34;</span>:<span style="color:#e6db74">&#34;password4&#34;</span>
    <span style="color:#f92672">}</span>,
    <span style="color:#e6db74">&#34;timeout&#34;</span>:300,
    <span style="color:#e6db74">&#34;method&#34;</span>:<span style="color:#e6db74">&#34;chacha20&#34;</span>,
    <span style="color:#e6db74">&#34;fast_open&#34;</span>: false
<span style="color:#f92672">}</span>
</code></pre></div><h1 id="常见维护操作">常见维护操作<a hidden class="anchor" aria-hidden="true" href="#常见维护操作">#</a></h1>
<p>升级 ss</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pip install -U shadowsocks
</code></pre></div><p>卸载 ss</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pip uninstall shadowsocks
</code></pre></div><p>停止 ss 服务</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">systemctl stop shadowsocks-server.service
</code></pre></div><h1 id="让-mailapp-复活">让 Mail.app 复活<a hidden class="anchor" aria-hidden="true" href="#让-mailapp-复活">#</a></h1>
<p>我用了 Proximac，但是，鉴于苹果在升级到 10.11 El Capitan 之后，不允许哪怕 root 用户修改 /usr，所以 homebrew 没办法用了。必须要先<a href="https://github.com/Homebrew/homebrew/blob/master/share/doc/homebrew/El_Capitan_and_Homebrew.md">修改权限</a>。官方的解释请看<a href="https://developer.apple.com/videos/play/wwdc2015-706/">这里</a>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo chown <span style="color:#66d9ef">$(</span>whoami<span style="color:#66d9ef">)</span>:admin /usr/local <span style="color:#f92672">&amp;&amp;</span> sudo chown -R <span style="color:#66d9ef">$(</span>whoami<span style="color:#66d9ef">)</span>:admin /usr/local
</code></pre></div><p>注意，要使 /usr/local/sbin 也在你的路径变量里面。因为我是用的 fish, 其环境变量是在 .config/fish/config.fish 里面设置。于是，添加这个路径可以这样写：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">set PATH /usr/local/sbin $PATH
</code></pre></div><p>可以用  echo &ldquo;$PATH&rdquo; 来检查路径好了没。然后，我们来试试 homebrew 好了没。
[未完，待续&hellip;]
【更新】下面就是安装 proximac 了！我已经 fork 了<a href="https://github.com/tigertooth4/proximac">这个项目</a>。根据作者的指导，第一步要安装 libuv 这个库。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">brew install libuv
</code></pre></div><p>然后下载安装文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -fsSL https://raw.githubusercontent.com/proximac-org/proximac-install/master/install.py |python
</code></pre></div><p>其实这一步就是从网上把写好的 zip 包下载下来，解压，改权限，放到 /usr/local/proximac 目录下面。最重要的就是 kext 内核扩展文件。运行 /usr/local/bin/proximac 的时候主要调用的是这个。但是，从 Mac OSX El Capitan 以后，系统引进了所谓 rootless 的特性，就是不再允许哪怕是 root 用户修改特定的系统文件（苹果这么做的原因可以参考<a href="https://developer.apple.com/videos/play/wwdc2015-706/">WWDC15的视频</a>）</p>
<p>因此，如果想继续使用 proximac 只有一种办法，那就是禁用掉这个新特性，public beta 版本中的修改内核参数的方法在正式版中会失效，唯一的办法就是在启动的时候用 csrutil 这个工具:</p>
<ol>
<li>启动时按住 command+R 直到进入保护模式</li>
<li>在保护模式中打开终端，输入如下指令 csrutil disable (注意：csrutil enable &ndash;without debug 这种写法将来恐怕也会失效，所以最好还是用 disable 这个选项）</li>
<li>正常重启动
用了这招，proximac 就可以正常启动了！</li>
</ol>
<p>![](~/屏幕快照 2015-10-05 上午12.25.28.png)</p>
<h1 id="参考">参考<a hidden class="anchor" aria-hidden="true" href="#参考">#</a></h1>
<ul>
<li><a href="https://www.ifshow.com/centos-7-installation-and-configuration-shadowsocks/">IFshow（主要参考）</a></li>
<li><a href="https://www.ifshow.com/centos-7-shadowsocks-optimization/">IFshow 优化</a></li>
<li><a href="http://shadowsocks.blogspot.jp/2015/01/shadowsocks.html">史上最详细教程</a></li>
<li><a href="http://hi-rain.com/2015/09/17/CentOS-7%E7%B3%BB%E7%BB%9F%E6%9E%B6%E8%AE%BEShadowsocks-libev%E6%9C%8D%E5%8A%A1%E5%99%A8/">破.前路的 CentOS7 libev 配置</a></li>
<li><a href="https://gist.github.com/aa65535/ea090063496b0d3a1748">aa65535 的 gist</a></li>
<li><a href="https://vfasky.com/2013-05-17/shadowsocks-centos6/">vfasky 的在 CentOS6 上部署（要用 iptables）</a></li>
<li><a href="https://teddysun.com/357.html">teddysun 的一键安装脚本 libev 版</a></li>
<li><a href="https://teddysun.com/339.html">teddysun 的 python 版(含加密方式讨论)</a></li>
<li><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html#sec-Introduction_to_firewalld">CentOS 7 中使用的防火墙 firewalld 的使用说明</a></li>
<li><a href="http://stackoverflow.com/questions/29099404/ssl-insecureplatform-error-when-using-requests-package">Stackoverflow 中关于 InsecurePlatformWarning</a></li>
<li><a href="http://urllib3.readthedocs.org/en/latest/security.html">关于安装中的 InsecurePlatformWarning</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2015-706/">WWDC15</a></li>
<li><a href="http://www.v2ex.com/tag/rootless">v2ex 上面的讨论</a></li>
<li><a href="https://www.quora.com/How-do-I-turn-off-the-rootless-in-OS-X-El-Capitan-10-11">Quora 上面的讨论</a></li>
<li><a href="http://www.macworld.com/article/2986118/security/how-to-modify-system-integrity-protection-in-el-capitan.html">Macworld 上面关于如何修改的讨论</a></li>
<li><a href="https://forums.developer.apple.com/thread/3981">Apple 官方论坛上的讨论</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://tigertooth4.github.io/tags/ss/">SS</a></li>
      <li><a href="http://tigertooth4.github.io/tags/vpn/">VPN</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="http://tigertooth4.github.io">思｜制 - A guy&#39;s thinking and making</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
